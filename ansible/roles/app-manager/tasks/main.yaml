---

- name: Getting volume infro from the kube file
  delegate_to: localhost
  kube_file_info:
    kube_file: '../deployments/nginx-waf/kube-file.yaml'
  register: kube

# - debug:
    # msg: "{{ item.name }} | {{ item.type }} | {{ item.src }} | {{ item.dst }}"
#   loop: "{{ kube.volumes }}"

- name: Create volume
  containers.podman.podman_volume:
    name: "{{ item.name }}"
    state: present
  when: (item.action == "create_empty") or
        (item.action == "create_and_copy")
  loop: "{{ kube.volumes }}"

- name: Copy files to volume"
  debug:
    msg: "Copy files to volume"
  loop: "{{ kube.volumes }}"
  when: item.action == "create_and_copy"

# - name: Copy the assets to the OCI host
#   ansible.builtin.copy:
#     src: "{{ app_src }}/"
#     dest: "{{ dpl_base }}/{{ app_name }}/"
#     remote_src: no
#     validate: /usr/bin/ls %s
#
# - name: Deploy app
#   containers.podman.podman_play:
#     kube_file: "{{ dpl_base }}/{{ app_name }}/kube-file.yaml"
#     network: production
#     recreate: true
#     state: started
